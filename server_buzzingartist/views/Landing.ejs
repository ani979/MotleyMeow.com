
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="js/utils.js"></script>
        <script src="js/jquery.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootstrap-dialog.js"></script>
        <link href="css/style.css" rel="stylesheet">       
        <link href="css/tab.css" rel="stylesheet">
        <link href="indexPage/css/font-awesome.min.css" rel="stylesheet">
        <link href="css/bootstrap-dialog.css" rel="stylesheet">
        <link href="css/bootstrap.css" rel="stylesheet">
  </head>
  
  <body>

<% getDate = function(x) {
            var retDate;
            MM = {1:"January", 2:"February", 3:"March", 4:"April", 5:"May", 6:"June", 7:"July", 8:"August", 9:"September", 
              10:"October", 11:"November", 12:"December"};

            xx = x.replace(
                  /(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}).(\d{3})Z/,
                  function($1,$2,$3,$4,$5,$6,$7, $8){                      
                      retDate= MM[parseInt($3)]+" "+$4+", "+$2
                  }
                ); 
            return retDate;
        }
    %>
<% if(typeof user != 'undefined' && user!=null) { %>
 <div id = "headerloggedin"> </div>
 <% } else { %>
 <div id = "headerloggedout"></div>
<%}%> 
<% var citysel = user.local.city %>
<div class = "main-container">
  <div class="col-md-12 no-margin no-padding" style = "text-align: center;">
    <h3 class = "thtrexplore">
      EXPLORE. CONNECT. CONTRIBUTE.
     </h3>
  </div>
  
  <div class="container">
    <h2 class="title" style= "text-align:center;">Hi, <strong> <%= user.facebook.name %> <strong></h2>
    <h3 style= "text-align:center;"><b>Welcome to BuzzingArtists.</b></h3>
    <% if (typeof citysel == 'undefined' || citysel == "") { %>
    <h4 style= "text-align:center;"> Your location is not set currently. Choose your location through <a href="/profile">"update profile"</a> link and view happenings in your city only.</h4>
    <% } %>  

    <hr class="half-rule">

    <div class="row">
      <div class="col-sm-3">
        <i class="homepageicon icon icon-book"></i>
        <h3>Update your profile</h3>
        <p>How do you contribute to theare? Acting/Lights designing/Music/Set Design etc.. <a href="/profile">Update it here</a> </p>
      </div>
      <div class="col-sm-3">
        <i class="homepageicon icon icon-search"></i><h3>Search Artists</h3>
        <p>Browse artists <a href="/artists"> here </a>, do an advance search and find out relevant artists who can help you
      </div>
      <div class="col-sm-3">
        <i class="homepageicon icon icon-hand-up"></i><h3>Post and help</h3>
        <p>Post auditions, post a need for artists etc. or help others for requests they have put up here<a href="/postarequest"> Post it here</a>
      </div>
      <div class="col-sm-3">
        <i class="homepageicon icon icon-eye-open"></i><h3>Experience theatre</h3>
        <p>Find out what event is coming up, search by the category of events<a href="/allevents"> Find out here </a> 
      </div>
    </div>
    <hr class="half-rule">
    
  </div>
  
  <div id = "recentPosts" class="col-md-6" style="vertical-align:top;"> 
  </div>
  

  <div id="recentArtists" class="col-md-6" style="vertical-align:top;"> 
  </div>     
  
  
  <div id="slide-3" style="clear:both;">
      <h2 style="text-align:center;"><a href="/allevents" >Buzzing Events in your city(Search all here)</a></h2>
      <% if (typeof events != 'undefined' && events != null && events.length != 0) { %>
        <div id="arrows">
          <div id="arrow-left"></div>
          <div id="arrow-right"></div>
        </div><!-- /.arrows -->

          <div class="row" style="position:relative">
          <% for(var i = 0; i < events.length; i++) {%>
              <%  var d = new Date(events[i].event.date).toISOString();
                    var displayableDate = getDate(d);
              %>
              <div class="col-12" style="padding-left:30px;">
                    <a href = "<%=events[i].event.link%>" target="_blank" style="max-width:300px;max-height:200px;text-decoration: none;">
                      <img src="<%=events[i].event.eventcover%>" border=0   style="max-width:300px;max-height:200px;"/>
                      <span style="color:#FFF9F9;font-size:small;position:relative;width:100%;"><%=events[i].event.title%></span>
                      <span style="color:#FFF9F9;font-size:small;position:relative;width:100%;"> on <%=displayableDate%></span>
                      <span style="color:#FFF9F9;font-size:small;position:relative;width:100%;"> in <%=events[i].event.city%></span>

                    </a>

              </div>
              
          <% }  %>
          </div><!-- /row -->
      
      <% } %>    
    </div><!-- /slide3 -->
  
    

</div>



         

   <div id = "footer"></div>
 
  <% var city = user.local.city;
     console.log("cityyyyyyyy: "+city);
     if(city == 'None') { %>
        <div class="form-group panel-body" id="myCity" style="margin:0px;padding:0px;">
            <label class="col-sm-3 control-label" for="city" style="padding:0px;">Location</label>
            <div class="col-sm-9"><select class="form-control" id="myCityForm" value="<%= user.local.city %>" name="city"><option>Bengaluru</option><option>Chennai</option><option>Delhi</option><option>Mumbai</option><option>Kolkata</option><option>None Of the above</option></select>
            </div>
            <div id="myRole" class="form-group">
              <label class="control-label">Your association or interests in theatre:</label> 
              <br>
                <div class = "col-sm-6">
                  <label class="checkbox-inline col-sm-3">
                        <input type="checkbox" id="checkboxinlineActing" name="role" value="Actor" > Acting
                  </label>
               </div>  
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineDirecting" name="role" value="Director" > Direction
                  </label>
                </div> 
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineSound" name="role" value="Sound" > Sound
                  </label>
                 </div> 
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineLights" name="role" value="Lights" > Lights Design
                  </label>
                 </div> 
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineMusic" name="role" value="Music" > Music
                  </label>
                 </div> 
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineScriptwriting" name="role" value="Scriptwriter" > Scriptwriting
                  </label>
                </div> 
               <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineCostume" name="role" value="Costume" > Costume Designing
                  </label>
                 </div> 
                <div class = "col-sm-6">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineSetDesign" name="role"  value="SetDesign" > Set Designing
                  </label>
                </div>
                <div class = "col-sm-12 col-md-12">
                  <label class="checkbox-inline">
                        <input type="checkbox" id="checkboxinlineAudience" name="role"  value="audience"> <strong><b>What? Theatre? But, i am just here to browse!!</b>
                  </label>
                </div>
              
                
            </div>
            
            <button id="donebtn" class="btn btn-primary pull-left" style="margin-top:30px;">DONE</button>
            <button id="closebtn" class="btn btn-warning pull-right" style="margin-top:30px;">Don't bore me now, will fill later</button>
        </div>
        <script type="text/javascript">
          $(document).ready(function(){
            var dialog = new BootstrapDialog({
            message: function(dialogRef){
                var $message = $('<div></div>');
                var $button = $('#donebtn');
                var $closeButton = $('#closebtn');
                
                $button.on('click', {dialogRef: dialogRef}, function(event){
                  var roles = $('input:checkbox[name="role"]:checked').map(function() {
                              return this.value;
                                }).get().join(',');
                  console.log("rolesssssssssssssss: "+roles);
                  var citiesss = $('select[name="city"]')[0].value;
                  console.log("citiesssssssss: "+citiesss);
                  if(citiesss == "None Of the above") citiesss = "";
                  console.log("citiesssssssss: "+citiesss);
                  event.data.dialogRef.close();
                  $.ajax({
                        url: "/getCity",
                        type: "POST",
                        data: {role: roles,city: citiesss},
                        // data: {$("#myCityForm").serialize(), role: roles},
                        success: function (data) {
                            console.log("City and role saved ");
                            location.reload();
                        },
                        error: function (data) {
                            console.log("some error " + data);
                        }
                        
                  });

                });

                $closeButton.on('click', {dialogRef: dialogRef}, function(event){
                    $.ajax({
                        url: "/getCity",
                        type: "POST",
                        data: {city: ""},
                        // data: {$("#myCityForm").serialize(), role: roles},
                        success: function (data) {
                            console.log("City and role saved ");
                        },
                        error: function (data) {
                            console.log("some error " + data);
                        }
                        
                    });
                    event.data.dialogRef.close();
                });
                // $message.append($selectedCity).append($button);
                $message.append($('#myCity'));
        
                return $message;
              },
              closable: false
          });
          dialog.realize();
          dialog.setTitle("Just very quickly add these basic info about yourself. You can change it in your profile section anytime");
          dialog.getModalHeader().show();
          dialog.getModalHeader().css('padding', '10px');
          dialog.getModalBody().css('background-color', '#1E485D');
          dialog.getModalBody().css('color', '#fff');
          dialog.open();
        });
          
        </script>      
  <% } %>

  <script src="js/jquery-1.10.2.min.js"></script>
  <script src="js/jquery-migrate-1.2.1.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/imageCarousel.js"></script>
  <script type="text/javascript">

    
$("#footer").load("footer.ejs"); 
$("#headerloggedin").load("/header");
$("#headerloggedout").load("headerloggedout.ejs");

        $(document).ready(function() {
          var form = $('#recentArtists');
          
          $("#recentArtists").load("/getRecentArtists");
          $("#recentPosts").load("/getRecentPosts");
          // Check to see every 10 mins..if a new user has joined
          var timerId;
          timerId = setInterval(function() {
            $("#recentArtists").load("/getRecentArtists");
            $("#recentPosts").load("/getRecentPosts");
          }, 10000); 
            
            
        });
        
        
          
    </script>
     <script type="text/javascript">
    window.doorbellOptions = {
        appKey: 'YSTK9OR2my1RS3mmACJS3iUrKcl7uldwR6Yv40opthKKgDxa0DzjbYNBOWBdS6H5'
    };
    (function(d, t) {
        var g = d.createElement(t);g.id = 'doorbellScript';g.type = 'text/javascript';g.async = true;g.src = 'https://doorbell.io/button/822';(d.getElementsByTagName('head')[0]||d.getElementsByTagName('body')[0]).appendChild(g);
    }(document, 'script'));
</script>
  </body>
</html>
